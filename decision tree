heart <- read.csv("heart.csv",header = T)
summary(heart)
str(heart)

#let sex cp exng rest_ecg fbs output to factor
library(dplyr)
cheart <- heart %>%
          select(-c(slp,thall))%>%
          mutate(sex = factor(sex,levels=c(0,1),labels=c('female','male')),
                 cp = factor(cp, levels = c(0,1,2,3),labels = c('typical','atypical','non-anginal','asymptomatic')),
                 exng = factor(exng, levels=c(0,1),labels=c('No','YES')),
                 restecg = factor(restecg, levels=c(0,1,2),labels=c('normal','ST-T wave abnormality','left ventricular hypertrophy')),
                 fbs = factor(fbs,levels=c(0,1),labels=c(FALSE,TRUE)),
                 output = factor(output,levels=c(0,1),labels=c('less','more')))

glimpse(cheart)

#creat training data and testing data
input_m <- cheart[which(cheart$output == 'more'),]
input_l <- cheart[which(cheart$output == 'less'),]

set.seed(100)
input_m_training <- sample(1:nrow(input_m),0.8*nrow(input_m))
input_l_training <- sample(1:nrow(input_l),0.8*nrow(input_l))

train_m <- input_m[input_m_training,]
train_l <- input_l[input_l_training,]
traindata <- rbind(train_m,train_l)

test_m <- input_m[-input_m_training,]
test_l <- input_l[-input_l_training,]
testdata <- rbind(test_m,test_l)

dim(traindata)
dim(testdata)
prop.table(table(traindata$output))
prop.table(table(testdata$output))

#################################
#model
#decision tree
#rpart

library(rpart)
library(rpart.plot)

fit <- rpart(output~., data=traindata,method='class')
rpart.plot(fit)


printcp(fit)
plotcp(fit)

predict_dec <- predict(fit, newdata = testdata, type='class')
tbl_dec <- table(predict_dec,testdata$output)
tbl_dec
accuracy <- sum(diag(tbl_dec))/sum(tbl_dec)
accuracy 

#prune tree
fit.prune <- prune(fit, cp = fit$cptable[which.min(fit$cptable[,'xerror']),'CP'])
rpart.plot(fit.prune) 

#k_fold
library(caret)
library(e1071)
train_c <- trainControl(method = 'cv',number = 10) #k=10
train_cmodel <- train(output~., data = traindata, method = 'rpart', na.action = na.pass,trControl = train_c)
train_cmodel

train_cmodel2 <- train(output~., data = traindata, method = 'rpart', na.action = na.rpart,trControl = train_c)
train_cmodel2


#decision tree
#conditional inference tree
library(party)
fit_ctree <- ctree(output~., data= traindata)
plot(fit_ctree)
predict_ctree <- predict(fit_ctree,newdata= testdata)
predict_ctree
tbl_ctree <-table(predicted=predict_ctree,actual = testdata$output )
tbl_ctree
accuract_ctree <- sum(diag(tbl_ctree))/sum(tbl_ctree)
accuract_ctree
